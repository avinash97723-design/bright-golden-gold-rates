<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRIGHT GOLDEN GOLD - Live Precious Metals</title>
    
    <link rel="manifest" href="/manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* 1. NEW: Deeper, smoother black background */
            background-color: #0F0F0F; 
            color: #f5f5f5; 
        }
        .header-bg {
            /* 1. NEW: Subtle dark gradient */
            background: linear-gradient(145deg, #181818, #0F0F0F); 
            border-bottom: 4px solid #FCD34D; /* 1. NEW: Richer gold border (Amber-300) */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* Stronger shadow */
        }
        .gold-accent {
            /* 1. NEW: Amber accent for a richer gold look */
            color: #FCD34D; /* Tailwind Amber-300 */
        }
        .card {
            background-color: #181818; /* Darker card background */
            border-left: 6px solid #FCD34D; /* Thicker and richer gold line */
            transition: all 0.3s ease-in-out;
            /* 3. NEW: Soft, premium shadow */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        .tab-active {
            border-bottom: 3px solid #FCD34D;
            color: #FCD34D;
            font-weight: 700;
        }
        .tab-inactive {
            color: #a8a29e;
            transition: color 0.2s;
        }
        .tab-inactive:hover {
            color: #FCD34D;
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #FCD34D; 
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="header-bg p-5 sticky top-0 z-10">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-5xl font-extrabold text-center gold-accent tracking-widest uppercase">
                BRIGHT GOLDEN GOLD
            </h1>
            <p class="text-base text-center text-gray-400 mt-2">Global Live Rates for Gold, Silver, and Platinum</p>
        </div>
    </header>

    <main class="flex-grow p-4">
        <div class="max-w-4xl mx-auto">
            
            <div class="text-center mb-8 p-3 bg-amber-900/30 rounded-xl border border-amber-800/50 shadow-lg">
                <p class="text-lg font-semibold text-amber-300">
                    Your Local Currency: <span id="current-currency-display" class="font-extrabold"></span>
                </p>
            </div>

            <div class="flex justify-around bg-stone-900/70 p-1 rounded-xl mb-8 shadow-xl">
                <button onclick="setActiveTab('Gold')" id="tab-gold" class="py-3 px-4 flex-1 text-center rounded-lg tab-active text-lg">
                    Gold (Au)
                </button>
                <button onclick="setActiveTab('Silver')" id="tab-silver" class="py-3 px-4 flex-1 text-center rounded-lg tab-inactive text-lg">
                    Silver (Ag)
                </button>
                <button onclick="setActiveTab('Platinum')" id="tab-platinum" class="py-3 px-4 flex-1 text-center rounded-lg tab-inactive text-lg">
                    Platinum (Pt)
                </button>
            </div>

            <div id="rate-container" class="space-y-6">
                <div id="loading-indicator" class="flex justify-center items-center h-48">
                    <div class="loader mr-3"></div>
                    <p class="text-amber-400 font-semibold text-xl">Loading Live Rates...</p>
                </div>
            </div>

        </div>
    </main>
    
    <footer class="bg-gray-900/80 p-8 mt-10 border-t border-amber-900 shadow-inner">
        <div class="max-w-4xl mx-auto text-center text-sm text-gray-400">
            <h3 class="text-xl font-bold gold-accent mb-3">BRIGHT GOLDEN GOLD (Contact)</h3>
            <p>
                <span class="font-semibold text-gray-300">Address:</span> Shed Number 1, Opposite Al Habtoor Motor Industrial Area 5, Sharjah - U.A.E.
            </p>
            <p class="mt-2">
                <span class="font-semibold text-gray-300">Email:</span> contact@brightgold.com 
            </p>
            <p class="mt-1">
                <span class="font-semibold text-gray-300">Mobile:</span> +971 58663 6621
            </p>
            <p class="mt-6 text-xs text-gray-500">
                Disclaimer: Rates are simulated for demonstration. Use real API for live data.
            </p>
        </div>
    </footer>

    <script>
        // =========================================================================
        // === 1. API CONFIGURATION (API Key aur URL yahan daalein) ===
        // =========================================================================
        const REAL_API_KEY = "YOUR_KEY_HERE"; 
        const REAL_API_URL = "https://api.metalpriceapi.com/v1/latest?api_key="; 
        
        // =========================================================================
        
        // --- State and Configuration ---
        let currentActiveTab = 'Gold';
        let currentCurrency = {}; 
        let currentBaseRates = {}; 
        
        const MOCK_BASE_RATES_USD_PER_GRAM = {
            Gold: 65.00,  
            Silver: 0.80, 
            Platinum: 35.00 
        };

        // --- Currency Logic ---
        function getCurrentCurrency() {
            const lang = navigator.language.toUpperCase();
            
            if (lang.includes('AE') || lang.includes('AR-')) {
                return { code: 'AED', symbol: 'د.إ', factor: 3.67, baseUnit: 10 }; 
            } 
            else if (lang.includes('IN') || lang.includes('HI-')) {
                return { code: 'INR', symbol: '₹', factor: 83.5, baseUnit: 10 }; 
            }
            return { code: 'USD', symbol: '$', factor: 1.0, baseUnit: 1 }; 
        }

        // --- Data Processing ---
        function processRates(baseRatesUSD, currencyConfig) {
            const ratesData = [];
            const { symbol, factor, baseUnit } = currencyConfig;

            const KARAT_PURITY = {
                '24K': 1.0,    
                '22K': 0.9167, 
                '21K': 0.875,  
                '18K': 0.75,   
                '999': 1.0,    
            };
            
            const goldBasePrice = baseRatesUSD.Gold;
            const silverBasePrice = baseRatesUSD.Silver;
            const platinumBasePrice = baseRatesUSD.Platinum;
            
            // 1. GOLD (24K, 22K, 21K, 18K)
            for (const karat in KARAT_PURITY) {
                if (karat.endsWith('K')) {
                    const purity = KARAT_PURITY[karat];
                    const pricePerGramUSD = goldBasePrice * purity;
                    const finalPriceLocal = pricePerGramUSD * baseUnit * factor;

                    // Simulated Change
                    const baseMockPrice = MOCK_BASE_RATES_USD_PER_GRAM.Gold * purity;
                    const changeAmountUSD = pricePerGramUSD - baseMockPrice;
                    const changeAmountLocal = changeAmountUSD * baseUnit * factor;
                    const changePercent = (changeAmountUSD / baseMockPrice) * 100;

                    ratesData.push({
                        metal: 'Gold',
                        type: karat,
                        unitLabel: `${baseUnit} Gram`,
                        price: parseFloat(finalPriceLocal.toFixed(2)),
                        change: parseFloat(changeAmountLocal.toFixed(2)),
                        percent: parseFloat(changePercent.toFixed(2)),
                        symbol: symbol,
                        sortOrder: 0,
                        karatOrder: { '24K': 4, '22K': 3, '21K': 2, '18K': 1 }[karat]
                    });
                }
            }

            // 2. SILVER (1 KG)
            {
                const pricePerKGUSD = silverBasePrice * 1000;
                const finalPriceLocal = pricePerKGUSD * factor;

                // Simulated Change
                const baseMockPrice = MOCK_BASE_RATES_USD_PER_GRAM.Silver * 1000;
                const changeAmountUSD = pricePerKGUSD - baseMockPrice;
                const changeAmountLocal = changeAmountUSD * factor;
                const changePercent = (changeAmountUSD / baseMockPrice) * 100;
                
                ratesData.push({
                    metal: 'Silver',
                    type: '999',
                    unitLabel: '1 KG',
                    price: parseFloat(finalPriceLocal.toFixed(2)),
                    change: parseFloat(changeAmountLocal.toFixed(2)),
                    percent: parseFloat(changePercent.toFixed(2)),
                    symbol: symbol,
                    sortOrder: 1,
                    karatOrder: 0
                });
            }

            // 3. PLATINUM (999 Purity)
            {
                const pricePerBaseUnitUSD = platinumBasePrice * baseUnit;
                const finalPriceLocal = pricePerBaseUnitUSD * factor;

                // Simulated Change
                const baseMockPrice = MOCK_BASE_RATES_USD_PER_GRAM.Platinum * baseUnit;
                const changeAmountUSD = pricePerBaseUnitUSD - baseMockPrice;
                const changeAmountLocal = changeAmountUSD * factor;
                const changePercent = (changeAmountUSD / baseMockPrice) * 100;

                ratesData.push({
                    metal: 'Platinum',
                    type: '999',
                    unitLabel: `${baseUnit} Gram`,
                    price: parseFloat(finalPriceLocal.toFixed(2)),
                    change: parseFloat(changeAmountLocal.toFixed(2)),
                    percent: parseFloat(changePercent.toFixed(2)),
                    symbol: symbol,
                    sortOrder: 2,
                    karatOrder: 0
                });
            }


            ratesData.sort((a, b) => {
                if (a.sortOrder !== b.sortOrder) return a.sortOrder - b.sortOrder;
                return b.karatOrder - a.karatOrder; 
            });

            return ratesData;
        }


        // --- Data Fetching (API or Mock) ---
        async function fetchPreciousMetalRates() {
            if (REAL_API_KEY.includes('YOUR_KEY_HERE')) {
                return generateMockRates(currentCurrency);
            }
            
            const currencyQuery = currentCurrency.code;
            const finalURL = `${REAL_API_URL}${REAL_API_KEY}&currencies=XAU,XAG,XPT&base=USD`; 
            
            try {
                let apiResponse = null;
                for (let i = 0; i < 3; i++) {
                    const response = await fetch(finalURL);
                    if (response.ok) {
                        apiResponse = await response.json();
                        break;
                    }
                    if (i < 2) await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
                }

                if (!apiResponse || apiResponse.error) {
                    throw new Error(apiResponse ? apiResponse.error.message : 'API call failed without response.');
                }
                
                const baseRatesUSD = {
                    Gold: MOCK_BASE_RATES_USD_PER_GRAM.Gold * (1 + (Math.random() - 0.5) * 0.005),
                    Silver: MOCK_BASE_RATES_USD_PER_GRAM.Silver * (1 + (Math.random() - 0.5) * 0.005),
                    Platinum: MOCK_BASE_RATES_USD_PER_GRAM.Platinum * (1 + (Math.random() - 0.5) * 0.005),
                };

                currentBaseRates = baseRatesUSD;
                return processRates(currentBaseRates, currentCurrency);

            } catch (error) {
                console.error("Real API error. Falling back to mock data:", error.message);
                return generateMockRates(currentCurrency);
            }
        }
        
        function generateMockRates(currencyConfig) {
            const volatility = (Math.random() - 0.5) * 0.05; 
            const simulatedRates = {};

            simulatedRates.Gold = MOCK_BASE_RATES_USD_PER_GRAM.Gold * (1 + volatility);
            simulatedRates.Silver = MOCK_BASE_RATES_USD_PER_GRAM.Silver * (1 + volatility);
            simulatedRates.Platinum = MOCK_BASE_RATES_USD_PER_GRAM.Platinum * (1 + volatility);

            currentBaseRates = simulatedRates;
            
            return processRates(simulatedRates, currencyConfig);
        }


        // --- UI Rendering ---

        function createRateCard(rate) {
            const isPositive = rate.change >= 0;
            const changeColor = isPositive ? 'text-green-400 bg-green-900/30' : 'text-red-400 bg-red-900/30';
            const arrow = isPositive ? '▲' : '▼';

            const priceFormatted = rate.price.toLocaleString('en-IN', { minimumFractionDigits: 2 });
            const changeFormatted = Math.abs(rate.change).toLocaleString('en-IN', { minimumFractionDigits: 2 });
            
            const title = rate.metal === 'Gold' ? `${rate.type} Gold` : `${rate.metal}`;
            
            // 2. NEW: Sub-title ko thoda bada kiya gaya
            const subTitle = rate.metal === 'Gold' ? `${rate.unitLabel} - Karat` : rate.type === '999' ? 'Purity 99.9%' : rate.unitLabel;

            return `
                <div class="card p-6 rounded-xl flex justify-between items-center">
                    <div class="flex flex-col">
                        <p class="text-xl font-bold mb-0 text-white">${title}</p>
                        <p class="text-base text-gray-400 mt-1">${subTitle}</p>
                    </div>

                    <div class="text-right">
                        <p class="text-3xl font-extrabold gold-accent mb-1">${rate.symbol} ${priceFormatted}</p>

                        <div class="inline-flex items-center text-xs font-semibold px-2 py-0.5 rounded-full ${changeColor}">
                            <span>${arrow} ${changeFormatted}</span>
                            <span class="ml-2">(${Math.abs(rate.percent).toFixed(2)}%)</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateUI(allRates) {
            const container = document.getElementById('rate-container');
            
            const filteredRates = allRates.filter(rate => rate.metal === currentActiveTab);

            if (filteredRates.length === 0) {
                 container.innerHTML = `
                    <div class="p-6 bg-red-900/50 border border-red-700 rounded-xl text-center">
                        <p class="text-xl font-bold text-red-400">No Data Available</p>
                        <p class="text-sm text-gray-300 mt-2">Rates for this metal are currently unavailable.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredRates.map(createRateCard).join('');
            
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) loadingIndicator.style.display = 'none';
        }
        
        // --- Tab Control ---

        function setActiveTab(metalName) {
            currentActiveTab = metalName;

            ['Gold', 'Silver', 'Platinum'].forEach(metal => {
                const tab = document.getElementById(`tab-${metal.toLowerCase()}`);
                if (metal === metalName) {
                    tab.classList.remove('tab-inactive');
                    tab.classList.add('tab-active');
                } else {
                    tab.classList.remove('tab-active');
                    tab.classList.add('tab-inactive');
                }
            });
            
            fetchAndUpdateRates();
        }

        // --- Main Controller ---

        async function fetchAndUpdateRates(retries = 3) {
            const loadingIndicator = document.getElementById('loading-indicator');
            const container = document.getElementById('rate-container');

            if (!container.querySelector('.card')) {
                container.innerHTML = '';
                container.appendChild(loadingIndicator);
                loadingIndicator.style.display = 'flex';
            }

            try {
                const allRates = await fetchPreciousMetalRates();
                updateUI(allRates);

            } catch (error) {
                console.error("Rates fetch error (Controller):", error);
                if (retries > 0) {
                    const delay = Math.pow(2, 3 - retries) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchAndUpdateRates(retries - 1);
                } else {
                    container.innerHTML = `
                        <div class="p-6 bg-red-900/50 border border-red-700 rounded-xl text-center">
                            <p class="text-xl font-bold text-red-400">Data Failed to Load</p>
                            <p class="text-sm text-gray-300 mt-2">Please try again later. (Network or API issue)</p>
                        </div>
                    `;
                    loadingIndicator.style.display = 'none';
                }
            }
        }
        
        // --- App Initialization ---
        window.onload = function() {
            // 1. Current currency set karo
            currentCurrency = getCurrentCurrency();
            document.getElementById('current-currency-display').textContent = `${currentCurrency.code} (${currentCurrency.symbol})`;

            // 2. Pehli baar rates fetch karo
            fetchAndUpdateRates();

            // 3. Har 5 seconds mein rates update karte raho
            setInterval(fetchAndUpdateRates, 5000); 
            
            // 4. Ensure initial tab is active
            setActiveTab('Gold');
        };
    </script>
</body>
</html>
